<div class="product-wrapper">
  <div class="product-container">
    
    <!-- Alerts -->
    <div class="alert alert-success" *ngIf="successMessage" (click)="successMessage = null">
      <span class="alert-icon">✓</span>
      <pre class="alert-message">{{ successMessage }}</pre>
    </div>
    <div class="alert alert-danger" *ngIf="errorMessage" (click)="errorMessage = null">
      <span class="alert-icon">⚠</span> {{ errorMessage }}
    </div>

    <div class="product-card">
      <div class="product-header">
        <h1>Add Product</h1>
        <p>Add a new product to your inventory</p>
      </div>

      <form [formGroup]="productForm" (ngSubmit)="onSubmit()">
        <div class="product-body">
          
          <!-- Product Name -->
          <div class="form-group">
            <label for="name">Product Name</label>
            <input 
              type="text" 
              id="name" 
              formControlName="name"
              placeholder="Enter product name"
              [class.error]="productForm.get('name')?.invalid && productForm.get('name')?.touched">
            <div class="error-msg" *ngIf="productForm.get('name')?.hasError('required') && productForm.get('name')?.touched">
              Product name is required.
            </div>
          </div>

          <!-- HSN Code & Packing -->
          <div class="form-row">
            <div class="form-group">
              <label for="hsn">HSN Code</label>
              <input 
                type="text" 
                id="hsn" 
                formControlName="hsn"
                placeholder="Enter HSN code"
                [class.error]="productForm.get('hsn')?.invalid && productForm.get('hsn')?.touched">
              <div class="error-msg" *ngIf="productForm.get('hsn')?.hasError('required') && productForm.get('hsn')?.touched">
                HSN code is required.
              </div>
            </div>

            <div class="form-group">
              <label for="packing">Packing</label>
              <input 
                type="text" 
                id="packing" 
                formControlName="packing"
                placeholder="e.g., 10x10 strips"
                [class.error]="productForm.get('packing')?.invalid && productForm.get('packing')?.touched">
              <div class="error-msg" *ngIf="productForm.get('packing')?.hasError('required') && productForm.get('packing')?.touched">
                Packing is required.
              </div>
            </div>
          </div>

          <div class="divider"></div>

          <!-- MRP -->
          <div class="form-group">
            <label for="mrp">MRP (₹)</label>
            <input 
              type="number" 
              id="mrp" 
              formControlName="mrp"
              placeholder="Enter MRP"
              step="0.01"
              min="0"
              [class.error]="productForm.get('mrp')?.invalid && productForm.get('mrp')?.touched">
            <div class="error-msg" *ngIf="productForm.get('mrp')?.hasError('required') && productForm.get('mrp')?.touched">
              MRP is required.
            </div>
            <div class="error-msg" *ngIf="productForm.get('mrp')?.hasError('min') && productForm.get('mrp')?.touched">
              MRP must be greater than 0.
            </div>
          </div>

          <div class="divider"></div>

          <!-- GST Section -->
          <div class="section-title">GST Details</div>

          <div class="form-row">
            <div class="form-group">
              <label for="cgst">CGST (%)</label>
              <input 
                type="number" 
                id="cgst" 
                formControlName="cgst"
                placeholder="Enter CGST %"
                step="0.01"
                min="0"
                max="100"
                [class.error]="productForm.get('cgst')?.invalid && productForm.get('cgst')?.touched">
              <div class="error-msg" *ngIf="productForm.get('cgst')?.hasError('required') && productForm.get('cgst')?.touched">
                CGST is required.
              </div>
              <div class="error-msg" *ngIf="(productForm.get('cgst')?.hasError('min') || productForm.get('cgst')?.hasError('max')) && productForm.get('cgst')?.touched">
                CGST must be between 0-100%.
              </div>
            </div>

            <div class="form-group">
              <label for="sgst">SGST (%)</label>
              <input 
                type="number" 
                id="sgst" 
                formControlName="sgst"
                placeholder="Enter SGST %"
                step="0.01"
                min="0"
                max="100"
                [class.error]="productForm.get('sgst')?.invalid && productForm.get('sgst')?.touched">
              <div class="error-msg" *ngIf="productForm.get('sgst')?.hasError('required') && productForm.get('sgst')?.touched">
                SGST is required.
              </div>
              <div class="error-msg" *ngIf="(productForm.get('sgst')?.hasError('min') || productForm.get('sgst')?.hasError('max')) && productForm.get('sgst')?.touched">
                SGST must be between 0-100%.
              </div>
            </div>
          </div>

          <!-- Total GST Display -->
          <div class="total-gst" *ngIf="productForm.get('cgst')?.value >= 0 && productForm.get('sgst')?.value >= 0">
            <span class="gst-label">Total GST:</span>
            <span class="gst-value">{{ (productForm.get('cgst')?.value || 0) + (productForm.get('sgst')?.value || 0) }}%</span>
          </div>

        </div>

        <div class="product-footer">
          <button type="button" class="bulk-btn" (click)="bulkModalOpen = true">
            <fa-icon [icon]="faUpload"></fa-icon>
            <span>Bulk Add/Update</span>
          </button>
          <button type="submit" class="submit-btn" [disabled]="productForm.invalid">
            Add Product
          </button>
        </div>
      </form>
    </div>

  </div>
</div>

<!-- Bulk upload modal -->
<app-bulk-upload-modal 
  *ngIf="bulkModalOpen" 
  (closed)="bulkModalOpen = false" 
  (result)="onBulkResult($event)">
</app-bulk-upload-modal>