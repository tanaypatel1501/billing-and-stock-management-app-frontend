<ng-template #noProductsMessage>
  <div class="empty-state-wrapper">
    <div class="empty-state-card">
      <div class="empty-state-icon">ðŸ“¦</div>
      <h2>No Products</h2>
      <p>Add products to see them listed here</p>
    </div>
  </div>
</ng-template>

<ng-container *ngIf="initialLoadComplete">
  <ng-container *ngIf="!isInitialEmpty; else noProductsMessage">

    <div class="dashboard-wrapper">
      <div class="main-content">

        <!-- Header -->
        <div class="modern-header">
          <div class="header-left">
            <button
              class="back-btn"
              *ngIf="searchText.length > 0"
              (click)="resetView()"
              title="Reset Filters & Search">
              <fa-icon [icon]="faArrowLeft"></fa-icon>
            </button>

            <div class="header-title-wrapper">
              <h1 class="header-title">
                <span class="title-text">Product List</span>
                <fa-icon [icon]="faCapsules" class="title-icon"></fa-icon>
              </h1>
              <span class="product-count">{{ productList.length }} item(s)</span>
            </div>
          </div>

          <div class="header-right">
            <app-search-bar
              [suggestions]="suggestions"
              [labelKey]="'name'"
              [subLabelKey]="'packing'"
              (onType)="handleTyping($event)"
              (onSelect)="handleSearch($event)"
              (onSearch)="handleSearch($event)"
              notFoundText="products">
            </app-search-bar>

            <app-filter-button
              [columns]="filterColumns"
              [currentSortBy]="sortColumn"
              [currentDirection]="sortDirection"
              (onApplySort)="handleFilterSort($any($event))">
            </app-filter-button>
          </div>
        </div>

        <!-- Table -->
        <div class="product-table-container">
          <div class="table-wrapper" (click)="collapseAll()">
            <table class="modern-product-table">
              <thead>
                <tr>
                  <th>#</th>
                  <th (dblclick)="onDoubleClickSort('name')" class="sortable-header">
                    Product Name
                    <span class="sort-icon">
                      <span *ngIf="sortColumn === 'name'">{{ sortDirection === 'asc' ? 'â†‘' : 'â†“' }}</span>
                      <span *ngIf="sortColumn !== 'name'" class="neutral-sort">â‡…</span>
                    </span>
                  </th>
                  <th (dblclick)="onDoubleClickSort('packing')" class="sortable-header">Packing
					<span class="sort-icon">
                      <span *ngIf="sortColumn === 'packing'">{{ sortDirection === 'asc' ? 'â†‘' : 'â†“' }}</span>
                      <span *ngIf="sortColumn !== 'packing'" class="neutral-sort">â‡…</span>
                    </span>
				  </th>
                  <th (dblclick)="onDoubleClickSort('HSN')" class="sortable-header">HSN
					<span class="sort-icon">
                      <span *ngIf="sortColumn === 'HSN'">{{ sortDirection === 'asc' ? 'â†‘' : 'â†“' }}</span>
                      <span *ngIf="sortColumn !== 'HSN'" class="neutral-sort">â‡…</span>
                    </span>
				  </th>
                  <th (dblclick)="onDoubleClickSort('MRP')" class="sortable-header">MRP
					<span class="sort-icon">
                      <span *ngIf="sortColumn === 'MRP'">{{ sortDirection === 'asc' ? 'â†‘' : 'â†“' }}</span>
                      <span *ngIf="sortColumn !== 'MRP'" class="neutral-sort">â‡…</span>
                    </span>
				  </th>
                  <th (dblclick)="onDoubleClickSort('CGST')" class="sortable-header">CGST
					<span class="sort-icon">
                      <span *ngIf="sortColumn === 'CGST'">{{ sortDirection === 'asc' ? 'â†‘' : 'â†“' }}</span>
                      <span *ngIf="sortColumn !== 'CGST'" class="neutral-sort">â‡…</span>
                    </span>
				  </th>
                  <th (dblclick)="onDoubleClickSort('SGST')" class="sortable-header">SGST
					<span class="sort-icon">
                      <span *ngIf="sortColumn === 'SGST'">{{ sortDirection === 'asc' ? 'â†‘' : 'â†“' }}</span>
                      <span *ngIf="sortColumn !== 'SGST'" class="neutral-sort">â‡…</span>
                    </span>
				  </th>
                  <th>Actions</th>
                </tr>
              </thead>

              <tbody>
                <tr
                  *ngFor="let product of productList; index as i"
                  class="mobile-card"
                  [class.expanded]="expandedIndex === i"
                  (click)="toggleCard(i); $event.stopPropagation()">

                  <td class="expandable" data-label="#">{{ i + 1 }}</td>
                  <td data-label="Product Name" class="product-name">{{ product.name }}</td>
                  <td class="expandable" data-label="Packing">{{ product.packing }}</td>
                  <td class="expandable" data-label="HSN">{{ product.hsn }}</td>
                  <td data-label="MRP" class="price">â‚¹{{ product.mrp | number }}</td>
                  <td class="expandable" data-label="CGST">{{ product.cgst }}%</td>
                  <td class="expandable" data-label="SGST">{{ product.sgst }}%</td>

                  <td data-label="Actions" class="action-cell">
                    <button class="icon-btn edit" (click)="edit(product.id)">
                      <fa-icon [icon]="faPencil"></fa-icon>
                    </button>
                    <button class="icon-btn delete" (click)="delete(product.id)">
                      <fa-icon [icon]="faTrashCan"></fa-icon>
                    </button>
                  </td>
                </tr>
              </tbody>

              <tbody *ngIf="productList.length === 0 && !isLoading" class="empty-state">
                <tr>
                  <td colspan="8" class="empty-state-cell">
                    <div class="empty-state-content">
                      No products found matching your criteria.
                    </div>
                  </td>
                </tr>
              </tbody>

            </table>
          </div>
        </div>

        <!-- Pagination -->
        <div class="modern-pagination d-none d-md-flex">
          <nav>
            <ul class="pagination-list">
              <li class="page-item" [class.disabled]="currentPage === 0">
                <a class="page-link" (click)="goToPage(0)">Â«</a>
              </li>
              <li class="page-item" [class.disabled]="currentPage === 0">
                <a class="page-link" (click)="goToPage(currentPage - 1)">â€¹</a>
              </li>

              <li
                class="page-item"
                *ngFor="let p of getVisiblePages()"
                [class.active]="currentPage === p">
                <a class="page-link" (click)="goToPage(p)">{{ p + 1 }}</a>
              </li>

              <li class="page-item" [class.disabled]="isLastPage">
                <a class="page-link" (click)="goToPage(currentPage + 1)">â€º</a>
              </li>
              <li class="page-item" [class.disabled]="isLastPage">
                <a class="page-link" (click)="goToPage(totalPages - 1)">Â»</a>
              </li>
            </ul>
          </nav>
        </div>

        <!-- Mobile Loader -->
        <div *ngIf="isLoading && productList.length > 0" class="mobile-loader d-md-none">
          <div class="spinner"></div>
        </div>

      </div>
    </div>

  </ng-container>
</ng-container>
