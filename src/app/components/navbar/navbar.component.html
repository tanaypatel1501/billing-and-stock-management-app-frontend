<!-- The primary fix is to use a single <nav> element for styling stability -->
<nav class="navbar navbar-expand-lg" data-bs-theme="dark" style="background-color: #000;">
    <div class="container-fluid">

        <!-- BRAND LINK (changes based on authentication state) -->
        <a class="navbar-brand" 
           [routerLink]="(isAuthenticated$ | async) ? (isAdminLoggedIn ? 'admin/dashboard' : 'user/dashboard') : 'home'" 
           style="color: #48e3cc;">
            GST Medicose
        </a>

        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarContent"
          aria-controls="navbarContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarContent">
            <ul class="navbar-nav me-auto my-2 my-lg-0 navbar-nav-scroll" style="--bs-scroll-height: 100px;"></ul>
            
            <!-- Link Group 1: Logged Out (Public) Links -->
            <ul class="navbar-nav ml-auto" *ngIf="!(isAuthenticated$ | async)">
                <li class="nav-item">
                    <a class="nav-link active" routerLink="/register" routerLinkActive="active-link" style="color: #48e3cc;">Register</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link active" routerLink="/login" routerLinkActive="active-link" style="color: #48e3cc;">Login</a>
                </li>
            </ul>

            <!-- Link Group 2: Logged In (User/Admin) Links -->
            <ul class="navbar-nav ml-auto" *ngIf="(isAuthenticated$ | async)">
              
              <!-- If Admin, show Admin Links -->
              <ng-container *ngIf="isAdminLoggedIn">
                <li class="nav-item">
                    <a class="nav-link" routerLink="/admin/add-product" routerLinkActive="active-link" style="color: #48e3cc;">Add Product</a>
                </li>
              </ng-container>

              <!-- If User (and not Admin), show User Links -->
              <ng-container *ngIf="isUserLoggedIn && !isAdminLoggedIn">
                <li class="nav-item">
                    <a class="nav-link" routerLink="/user/add-stock" routerLinkActive="active-link" style="color: #48e3cc;">Add Stock</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" routerLink="/user/create-bill" routerLinkActive="active-link" style="color: #48e3cc;">Create Bill</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" routerLink="/user/bills" routerLinkActive="active-link" style="color: #48e3cc;">Show Bills</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" routerLink="/user/details" routerLinkActive="active-link" style="color: #48e3cc;">Details</a>
                </li>
              </ng-container>
              
              <!-- Logout button (shared) -->
              <li class="nav-item">
                  <a class="nav-link" (click)="logout()" style="color: #48e3cc;">Log out</a>
              </li>
            </ul>

        </div>
    </div>
</nav>