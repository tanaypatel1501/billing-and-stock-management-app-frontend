<div class="profile-wrapper">
  <div class="profile-container">
    
    <!-- Feedback Alert -->
    <div *ngIf="feedbackMessage" class="alert" 
         [ngClass]="{'alert-success': !isError, 'alert-danger': isError}"
         (click)="feedbackMessage = null">
      <span class="alert-icon">{{ isError ? '⚠' : '✓' }}</span>
      {{ feedbackMessage }}
    </div>

    <!-- Profile Card -->
    <div class="profile-card">
      <div class="profile-header">
        <h1>Profile Details</h1>
        <p>Manage your account information</p>
      </div>

      <div class="profile-body" *ngIf="userProfile">
        
        <!-- First Name Row -->
        <div class="profile-row">
          <div class="profile-label">
            <label>First Name</label>
          </div>
          <div class="profile-value">
            <span *ngIf="!isEditing.firstname" class="value-text">{{ userProfile.firstname }}</span>
            <input *ngIf="isEditing.firstname" 
                   type="text" 
                   class="edit-input" 
                   [(ngModel)]="editData.firstname"
                   placeholder="Enter first name">
          </div>
          <div class="profile-actions">
            <button *ngIf="!isEditing.firstname" 
                    class="icon-btn edit-btn" 
                    (click)="enableEdit('firstname')" 
                    title="Edit First Name">
              <fa-icon [icon]="faPencil"></fa-icon>
            </button>
            <div *ngIf="isEditing.firstname" class="action-group">
              <button class="icon-btn save-btn" 
                      (click)="saveProfile('firstname')" 
                      title="Save">
                <fa-icon [icon]="faCheck"></fa-icon>
              </button>
              <button class="icon-btn cancel-btn" 
                      (click)="cancelEdit('firstname')" 
                      title="Cancel">
                <fa-icon [icon]="faTimes"></fa-icon>
              </button>
            </div>
          </div>
        </div>

        <!-- Last Name Row -->
        <div class="profile-row">
          <div class="profile-label">
            <label>Last Name</label>
          </div>
          <div class="profile-value">
            <span *ngIf="!isEditing.lastname" class="value-text">{{ userProfile.lastname }}</span>
            <input *ngIf="isEditing.lastname" 
                   type="text" 
                   class="edit-input" 
                   [(ngModel)]="editData.lastname"
                   placeholder="Enter last name">
          </div>
          <div class="profile-actions">
            <button *ngIf="!isEditing.lastname" 
                    class="icon-btn edit-btn" 
                    (click)="enableEdit('lastname')" 
                    title="Edit Last Name">
              <fa-icon [icon]="faPencil"></fa-icon>
            </button>
            <div *ngIf="isEditing.lastname" class="action-group">
              <button class="icon-btn save-btn" 
                      (click)="saveProfile('lastname')" 
                      title="Save">
                <fa-icon [icon]="faCheck"></fa-icon>
              </button>
              <button class="icon-btn cancel-btn" 
                      (click)="cancelEdit('lastname')" 
                      title="Cancel">
                <fa-icon [icon]="faTimes"></fa-icon>
              </button>
            </div>
          </div>
        </div>

        <!-- Email Row (Read-only) -->
        <div class="profile-row">
          <div class="profile-label">
            <label>Email</label>
          </div>
          <div class="profile-value">
            <span class="value-text readonly">{{ userProfile.email }}</span>
          </div>
          <div class="profile-actions">
            <span class="readonly-badge">Read-only</span>
          </div>
        </div>

        <!-- Password Row -->
        <div class="profile-row">
          <div class="profile-label">
            <label>Password</label>
          </div>
          <div class="profile-value">
            <span class="value-text password">••••••••</span>
          </div>
          <div class="profile-actions">
            <button class="change-password-btn" 
                    (click)="openChangePassword()" 
                    title="Change Password">
              Change
            </button>
          </div>
        </div>

      </div>

      <div class="profile-body loading-state" *ngIf="!userProfile">
        <div class="spinner"></div>
        <p>Loading profile...</p>
      </div>
    </div>

  </div>
</div>

<!-- Change Password Modal -->
<div class="modal-overlay" *ngIf="showPasswordModal" (click)="closeChangePassword()">
  <div class="modal-card" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>Change Password</h2>
      <button class="modal-close" (click)="closeChangePassword()">×</button>
    </div>

    <form [formGroup]="passwordForm" (ngSubmit)="submitPasswordChange()">
      <div class="modal-body">
        
        <!-- Current Password -->
        <div class="form-group">
          <label for="currentPassword">Current Password</label>
          <input 
            type="password" 
            id="currentPassword"
            formControlName="currentPassword" 
            placeholder="Enter current password"
            [class.error]="passwordForm.get('currentPassword')?.invalid && passwordForm.get('currentPassword')?.touched">
          
          <div class="error-msg" 
               *ngIf="passwordForm.get('currentPassword')?.hasError('required') && passwordForm.get('currentPassword')?.touched">
            Current password is required.
          </div>
          <div class="error-msg" *ngIf="modalErrorMessage">
            {{ modalErrorMessage }}
          </div>
        </div>

        <!-- New Password -->
        <div class="form-group">
          <label for="newPassword">New Password</label>
          <input 
            type="password" 
            id="newPassword"
            formControlName="newPassword" 
            placeholder="Enter new password"
            [class.error]="passwordForm.get('newPassword')?.invalid && passwordForm.get('newPassword')?.touched">
          
          <div class="error-msg" 
               *ngIf="passwordForm.get('newPassword')?.hasError('required') && passwordForm.get('newPassword')?.touched">
            New password is required.
          </div>
          <div class="error-msg info" 
               *ngIf="passwordForm.get('newPassword')?.hasError('invalidPassword') && passwordForm.get('newPassword')?.touched">
            Must be 8+ chars, with 1 uppercase, 1 digit, & 1 special char.
          </div>
        </div>

      </div>

      <div class="modal-footer">
        <button type="button" class="modal-btn secondary" (click)="closeChangePassword()">
          Cancel
        </button>
        <button type="submit" class="modal-btn primary" [disabled]="passwordForm.invalid">
          Save Changes
        </button>
      </div>
    </form>
  </div>
</div>