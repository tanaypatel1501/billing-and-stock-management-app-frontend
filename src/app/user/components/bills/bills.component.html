<ng-template #noBillsMessage>
  <div class="empty-state-wrapper">
    <div class="empty-state-card">
      <div class="empty-state-icon">üìÑ</div>
      <h2>No Bills Created Yet</h2>
      <p>Click on Create Bill to generate your first invoice</p>
    </div>
  </div>
</ng-template>

<ng-container *ngIf="initialLoadComplete">
  <ng-container *ngIf="!isInitialEmpty; else noBillsMessage">
    
    <div class="bills-wrapper">
      <div class="main-content">
        
        <!-- Modern Header -->
        <div class="modern-header">
          <div class="header-left">
            <button
              class="back-btn"
              (click)="resetView()"
              title="Reset Filters & Search"
              *ngIf="isSearchActive || sortColumn">
              <fa-icon [icon]="faArrowLeft"></fa-icon>
            </button>
            
            <div class="header-title-wrapper">
              <h1 class="header-title">
                <span class="title-text">Bills</span>
                <fa-icon [icon]="faMoneyBillTrendUp" class="title-icon"></fa-icon>
              </h1>
              <span class="bill-count">{{ bills.length }} bill(s)</span>
            </div>
          </div>

          <div class="header-right">
            <app-search-bar 
              [suggestions]="suggestions" 
              [isLoading]="isLoading"
              [labelKey]="'purchaserName'" 
              [subLabelKey]="'invoiceDateFormatted'"
              (onType)="handleTyping($event)" 
              (onSelect)="handleSearch($event)" 
              (onSearch)="handleSearch($event)"
              notFoundText="bills">
            </app-search-bar>
            <app-filter-button 
              [columns]="filterColumns" 
              [currentSortBy]="sortColumn" 
              [currentDirection]="sortDirection"
              (onApplySort)="handleFilterSort($any($event))">
            </app-filter-button>
          </div>
        </div>

        <!-- Bills List -->
        <div class="bills-container">
          <div *ngFor="let bill of bills" class="bill-card" (click)="openBill(bill.id)">
            <div class="bill-header">
              <div class="bill-icon">
                <fa-icon [icon]="faFileInvoice"></fa-icon>
              </div>
              <div class="bill-info">
                <h3 class="bill-purchaser">{{ bill.purchaserName }}</h3>
                <span class="bill-date">
                  <fa-icon [icon]="faCalendar"></fa-icon>
                  {{ bill.invoiceDate | date:'dd MMM yyyy' }}
                </span>
              </div>
            </div>
            
            <div class="bill-footer">
              <span class="view-link">
                View Details
                <fa-icon [icon]="faArrowRight"></fa-icon>
              </span>
            </div>
          </div>

          <!-- Empty Search Results -->
          <div *ngIf="bills.length === 0 && !isLoading && initialLoadComplete" class="empty-search-state">
            <div class="empty-icon">üîç</div>
            <p>No bills found matching your criteria.</p>
          </div>
        </div>

        <!-- Modern Pagination -->
        <div *ngIf="bills.length > 0" class="modern-pagination d-none d-md-flex">
          <nav aria-label="Page navigation">
            <ul class="pagination-list">
              <!-- First Page -->
              <li class="page-item" [class.disabled]="currentPage === 0">
                <a class="page-link" (click)="goToPage(0)">
                  <span>¬´</span>
                </a>
              </li>
              
              <!-- Previous -->
              <li class="page-item" [class.disabled]="currentPage === 0">
                <a class="page-link" (click)="goToPage(currentPage - 1)">
                  <span>‚Äπ</span>
                </a>
              </li>

              <!-- Dynamic Page Numbers -->
              <li class="page-item" *ngFor="let p of getVisiblePages()" [class.active]="currentPage === p">
                <a class="page-link" (click)="goToPage(p)">{{ p + 1 }}</a>
              </li>

              <!-- Next -->
              <li class="page-item" [class.disabled]="isLastPage">
                <a class="page-link" (click)="goToPage(currentPage + 1)">
                  <span>‚Ä∫</span>
                </a>
              </li>
              
              <!-- Last Page -->
              <li class="page-item" [class.disabled]="isLastPage">
                <a class="page-link" (click)="goToPage(totalPages - 1)">
                  <span>¬ª</span>
                </a>
              </li>
            </ul>
          </nav>
        </div>

        <!-- Mobile Loading Spinner -->
        <div *ngIf="isLoading && bills.length > 0" class="mobile-loader d-md-none">
          <div class="spinner"></div>
          <p>Loading more bills...</p>
        </div>

      </div>
    </div>

  </ng-container>
</ng-container>