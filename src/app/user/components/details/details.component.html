<div class="details-wrapper">
  <div class="details-container">
    
    <!-- Alerts -->
    <div class="alert alert-success" *ngIf="successMessage" (click)="successMessage = null">
      <span class="alert-icon">âœ“</span> {{ successMessage }}
    </div>
    <div class="alert alert-danger" *ngIf="errorMessage" (click)="errorMessage = null">
      <span class="alert-icon">âš </span> {{ errorMessage }}
    </div>

    <div class="details-card">
      <div class="details-header">
        <h1>Business Details</h1>
        <p>Complete your business information</p>
      </div>

      <form [formGroup]="detailsForm" (ngSubmit)="onSubmit()">
        <div class="details-body">
          
          <!-- Logo Upload Section -->
          <div class="logo-section">
            <div class="logo-label">
              <label>Business Logo</label>
              <span class="optional-badge">Optional</span>
            </div>
            
            <div class="logo-container">
              <div class="logo-preview">
                <img [src]="logoPreviewUrl || defaultLogoUrl" alt="Business Logo" class="logo-image">
                <div class="logo-overlay" *ngIf="!isUploadingLogo">
                  <button type="button" class="upload-trigger-btn" (click)="fileInput.click()">
                    <span class="upload-icon">ðŸ“·</span>
                    <span>{{ logoPreviewUrl ? 'Change' : 'Upload' }} Logo</span>
                  </button>
                </div>
                <div class="logo-overlay loading" *ngIf="isUploadingLogo">
                  <div class="spinner-small"></div>
                </div>
              </div>
              
              <input 
                #fileInput
                type="file" 
                accept="image/*" 
                (change)="onLogoSelected($event)"
                style="display: none">
              
              <div class="logo-info">
                <p class="info-text">Recommended: Square image (1:1 ratio), max 2MB</p>
                <button 
                  type="button" 
                  class="reset-logo-btn" 
                  *ngIf="previewLogoUrl"
                  (click)="resetLogo()">
                  Reset to Default
                </button>
              </div>
            </div>
          </div>

          <div class="divider"></div>

          <!-- Business Information -->
          <div class="section-title">Business Information</div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="name">Business Name <span class="required">*</span></label>
              <input 
                type="text" 
                id="name" 
                formControlName="name" 
                placeholder="Enter Business / Medical Store Name"
                [class.error]="detailsForm.get('name')?.invalid && detailsForm.get('name')?.touched">
              <div class="error-msg" *ngIf="detailsForm.get('name')?.hasError('required') && detailsForm.get('name')?.touched">
                Name is required.
              </div>
              <div class="error-msg" *ngIf="detailsForm.get('name')?.hasError('minlength') && detailsForm.get('name')?.touched">
                Name must be at least 2 characters.
              </div>
            </div>

            <div class="form-group">
              <label for="phoneNumber">Phone Number <span class="required">*</span></label>
              <input 
                type="text" 
                id="phoneNumber" 
                formControlName="phoneNumber" 
                placeholder="Enter 10-digit Mobile Number"
                [class.error]="detailsForm.get('phoneNumber')?.invalid && detailsForm.get('phoneNumber')?.touched">
              <div class="error-msg" *ngIf="detailsForm.get('phoneNumber')?.hasError('required') && detailsForm.get('phoneNumber')?.touched">
                Phone number is required.
              </div>
              <div class="error-msg" *ngIf="detailsForm.get('phoneNumber')?.hasError('pattern') && detailsForm.get('phoneNumber')?.touched">
                Enter a valid 10-digit phone number.
              </div>
            </div>
          </div>

          <div class="divider"></div>

          <!-- Address Section -->
          <div class="section-title">Business Address</div>

          <div class="form-row">
            <div class="form-group">
              <label for="addressLine1">Address Line 1 <span class="required">*</span></label>
              <input 
                type="text" 
                id="addressLine1" 
                formControlName="addressLine1" 
                placeholder="Shop No., Building Name"
                [class.error]="detailsForm.get('addressLine1')?.invalid && detailsForm.get('addressLine1')?.touched">
              <div class="error-msg" *ngIf="detailsForm.get('addressLine1')?.hasError('required') && detailsForm.get('addressLine1')?.touched">
                Address Line 1 is required.
              </div>
              <div class="error-msg" *ngIf="detailsForm.get('addressLine1')?.hasError('minlength') && detailsForm.get('addressLine1')?.touched">
                Must be at least 3 characters.
              </div>
            </div>

            <div class="form-group">
              <label for="addressLine2">Address Line 2 <span class="required">*</span></label>
              <input 
                type="text" 
                id="addressLine2" 
                formControlName="addressLine2" 
                placeholder="Street Name / Locality"
                [class.error]="detailsForm.get('addressLine2')?.invalid && detailsForm.get('addressLine2')?.touched">
              <div class="error-msg" *ngIf="detailsForm.get('addressLine2')?.hasError('required') && detailsForm.get('addressLine2')?.touched">
                Address Line 2 is required.
              </div>
              <div class="error-msg" *ngIf="detailsForm.get('addressLine2')?.hasError('minlength') && detailsForm.get('addressLine2')?.touched">
                Must be at least 3 characters.
              </div>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="state">State <span class="required">*</span></label>
              <select 
                id="state" 
                formControlName="state"
                [class.error]="detailsForm.get('state')?.invalid && detailsForm.get('state')?.touched">
                <option [ngValue]="null" disabled>Select a state</option>
                <option *ngFor="let state of states" [ngValue]="state">{{ state }}</option>
              </select>
              <div class="error-msg" *ngIf="detailsForm.get('state')?.hasError('required') && detailsForm.get('state')?.touched">
                State is required.
              </div>
            </div>

            <div class="form-group">
              <label for="city">City/District <span class="required">*</span></label>
              <select 
                id="city" 
                formControlName="city" 
                [disabled]="!detailsForm.get('state')?.value"
                [class.error]="detailsForm.get('city')?.invalid && detailsForm.get('city')?.touched">
                <option [ngValue]="null" disabled>Select a city/district</option>
                <option *ngFor="let city of cities" [ngValue]="city">{{ city }}</option>
              </select>
              <div class="error-msg" *ngIf="detailsForm.get('city')?.hasError('required') && detailsForm.get('city')?.touched">
                City/District is required.
              </div>
            </div>
          </div>

          <div class="form-group full-width">
            <label for="pincode">Pincode <span class="required">*</span></label>
            <input 
              list="pincodeOptions" 
              id="pincode" 
              formControlName="pincode" 
              placeholder="Type or select Pincode"
              [class.error]="detailsForm.get('pincode')?.invalid && detailsForm.get('pincode')?.touched">
            <datalist id="pincodeOptions">
              <option *ngFor="let address of pincodeAddresses" [value]="address.pincode">
                {{ address.pincode }}
              </option>
            </datalist>
            <div class="error-msg" *ngIf="detailsForm.get('pincode')?.hasError('required') && detailsForm.get('pincode')?.touched">
              Pincode is required.
            </div>
            <div class="error-msg" *ngIf="detailsForm.get('pincode')?.hasError('pattern') && detailsForm.get('pincode')?.touched">
              Pincode must be 6 digits.
            </div>
          </div>

          <div class="divider"></div>

          <!-- Licenses Section -->
          <div class="section-title">Licenses & Registration</div>

          <div class="form-row">
            <div class="form-group">
              <label for="dlNo1">DL No. 1 <span class="required">*</span></label>
              <input 
                type="text" 
                id="dlNo1" 
                formControlName="dlNo1" 
                placeholder="Enter Drug License No. 1"
                [class.error]="detailsForm.get('dlNo1')?.invalid && detailsForm.get('dlNo1')?.touched">
              <div class="error-msg" *ngIf="detailsForm.get('dlNo1')?.hasError('required') && detailsForm.get('dlNo1')?.touched">
                DL No. 1 is required.
              </div>
              <div class="error-msg info" *ngIf="detailsForm.get('dlNo1')?.hasError('pattern') && detailsForm.get('dlNo1')?.touched">
                10â€“30 characters; letters, numbers, hyphen, slash, space allowed.
              </div>
            </div>

            <div class="form-group">
              <label for="dlNo2">DL No. 2 <span class="required">*</span></label>
              <input 
                type="text" 
                id="dlNo2" 
                formControlName="dlNo2" 
                placeholder="Enter Drug License No. 2"
                [class.error]="detailsForm.get('dlNo2')?.invalid && detailsForm.get('dlNo2')?.touched">
              <div class="error-msg" *ngIf="detailsForm.get('dlNo2')?.hasError('required') && detailsForm.get('dlNo2')?.touched">
                DL No. 2 is required.
              </div>
              <div class="error-msg info" *ngIf="detailsForm.get('dlNo2')?.hasError('pattern') && detailsForm.get('dlNo2')?.touched">
                10â€“30 characters; letters, numbers, hyphen, slash, space allowed.
              </div>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="fssaiReg">FSSAI Registration <span class="required">*</span></label>
              <input 
                type="text" 
                id="fssaiReg" 
                formControlName="fssaiReg" 
                placeholder="Enter FSSAI Registration Number"
                [class.error]="detailsForm.get('fssaiReg')?.invalid && detailsForm.get('fssaiReg')?.touched">
              <div class="error-msg" *ngIf="detailsForm.get('fssaiReg')?.hasError('required') && detailsForm.get('fssaiReg')?.touched">
                FSSAI Registration is required.
              </div>
            </div>

            <div class="form-group">
              <label for="gstin">GSTIN <span class="required">*</span></label>
              <input 
                type="text" 
                id="gstin" 
                formControlName="gstin" 
                placeholder="e.g., 22ABCDE1234F1Z5"
                [class.error]="detailsForm.get('gstin')?.invalid && detailsForm.get('gstin')?.touched">
              <div class="error-msg" *ngIf="detailsForm.get('gstin')?.hasError('required') && detailsForm.get('gstin')?.touched">
                GSTIN is required.
              </div>
              <div class="error-msg info" *ngIf="detailsForm.get('gstin')?.hasError('pattern') && detailsForm.get('gstin')?.touched">
                Must be 15 characters: 2 digits, 5 letters, 4 digits, 1 letter, 1 alnum, 'Z', 1 alnum.
              </div>
            </div>
          </div>

          <div class="divider"></div>

          <!-- Banking Section -->
          <div class="section-title">Banking Details</div>

          <div class="form-row">
            <div class="form-group">
              <label for="bankName">Bank Name <span class="required">*</span></label>
              <input 
                type="text" 
                id="bankName" 
                formControlName="bankName" 
                placeholder="Enter Bank Name"
                [class.error]="detailsForm.get('bankName')?.invalid && detailsForm.get('bankName')?.touched">
              <div class="error-msg" *ngIf="detailsForm.get('bankName')?.hasError('required') && detailsForm.get('bankName')?.touched">
                Bank name is required.
              </div>
            </div>

            <div class="form-group">
              <label for="accountNumber">Account Number <span class="required">*</span></label>
              <input 
                type="text" 
                id="accountNumber" 
                formControlName="accountNumber" 
                placeholder="Enter Bank Account Number"
                [class.error]="detailsForm.get('accountNumber')?.invalid && detailsForm.get('accountNumber')?.touched">
              <div class="error-msg" *ngIf="detailsForm.get('accountNumber')?.hasError('required') && detailsForm.get('accountNumber')?.touched">
                Account number is required.
              </div>
              <div class="error-msg" *ngIf="detailsForm.get('accountNumber')?.hasError('pattern') && detailsForm.get('accountNumber')?.touched">
                Must be numeric and 9â€“18 digits long.
              </div>
            </div>
          </div>

          <div class="form-group full-width">
            <label for="ifscCode">IFSC Code <span class="required">*</span></label>
            <input 
              type="text" 
              id="ifscCode" 
              formControlName="ifscCode" 
              placeholder="e.g., SBIN0001234"
              [class.error]="detailsForm.get('ifscCode')?.invalid && detailsForm.get('ifscCode')?.touched">
            <div class="error-msg" *ngIf="detailsForm.get('ifscCode')?.hasError('required') && detailsForm.get('ifscCode')?.touched">
              IFSC code is required.
            </div>
            <div class="error-msg" *ngIf="detailsForm.get('ifscCode')?.hasError('pattern') && detailsForm.get('ifscCode')?.touched">
              IFSC must be 11 characters (AAAA0######).
            </div>
          </div>

        </div>

        <div class="details-footer">
          <button type="submit" class="submit-btn" [disabled]="detailsForm.invalid">
            Save Business Details
          </button>
        </div>
      </form>
    </div>

  </div>
</div>
<div class="modal-overlay" *ngIf="showCropModal">
  <div class="crop-modal-card">

    <div class="modal-header">
      <h2>Crop Business Logo</h2>
      <button class="modal-close" (click)="closeCropModal()">Ã—</button>
    </div>

    <div class="modal-body">
      <div class="crop-container">
        <image-cropper
          #cropper
          [imageChangedEvent]="imageChangedEvent"
          [maintainAspectRatio]="true"
          [aspectRatio]="1"
          [resizeToWidth]="400"
          [transform]="transform"
          format="png"
          (imageCropped)="imageCropped($event)">
        </image-cropper>
      </div>

      <div class="crop-controls">
        <button class="control-btn" (click)="zoomOut()">Zoom âˆ’</button>
        <button class="control-btn" (click)="zoomIn()">Zoom +</button>
      </div>
    </div>

    <div class="modal-footer">
      <button class="modal-btn secondary" (click)="closeCropModal()">Cancel</button>
      <button class="modal-btn primary" (click)="confirmCrop()">Use Image</button>
    </div>

  </div>
</div>
